Техническое задание и возможный функционал скрипта для терминала QUIK 
Техническое задание 
Техническое задание (ТЗ) - это набор правил и требований, адресуемых разработчику для создания проекта.  
ТЗ должно не просто описывать общую идею, а доходчиво и однозначно объяснять хорошо продуманную логику алгоритма, на описание которой может уходить от нескольких часов до нескольких дней. Даже для простых задач! 
Рекомендую разбивать все необходимые требования на отдельные пункты вместо их оформления в виде сплошного текста, а также использовать конструкции «Если ..., то …». Такой подход не только облегчит оценку требуемого количества часов на разработку, но и поможет вам лучше продумать поставленные задачи и логику алгоритма. 
Структурирование и конкретика — ключ к взаимопониманию! 
Пример ТЗ  
Пример ТЗ для разработки торгового робота на основе пересечения скользящих средних (MA) для терминала QUIK. 
Задача  
Разработать торговый робот, осуществляющий автоматическое открытие и закрытие позиции на основе пересечения быстрой (FMA) и медленной (SMA) скользящей средней, а также осуществляющий автоматическое выставление и снятие стоп-лосс (СЛ) и тейк-профит (ТП) при открытии, изменении или закрытии позиции. 
Робот должен включать: 
1.	Возможность запуска при имеющейся открытой позиции произвольного объема. 
2.	Возможность работы в конкретном направлении: «Long», «Short», «Revers». 
3.	Возможность работы 2-х режимах торговли: «Непрерывно», «Закрытие позиции». 
4.	Вывод в интерфейс значения текущей чистой позиции. 
Название робота  «MA Bot» Классы торгуемых активов  Фьючерсы Поля интерфейса 
Торговый счет  
Код инструмента 
Объем заявки  
Пересечение (задается в пунктах)  
Стоп-лосс (задается в пунктах) 
Тейк-профит (задается в пунктах) 
Идентификатор FMA 
Идентификатор SMA 
Кнопка «Направление» 
Кнопка «Режим торговли» 
Кнопка «Запустить/Остановить» 
Позиция 
Открытие позиции  
Если при запуске робота позиция по инструменту закрыта, то робот должен дождаться, когда линии поменяются местами (FMA станет выше SMA или наоборот), и после этого выполнять открытие позиции на следующих условиях: 
Открытие длинной позиции должно происходить когда FMA становится выше SMA на «Пересечение» пунктов. 
Открытие короткой позиции должно происходить когда FMA становится ниже SMA на «Пересечение» пунктов. 
Позиция должна открывается объемом «Объем заявки». 
Разворот позиции  
Разворот позиции может происходить если параметр «Направление» имеет значение «Revers». В таком случае разворот позиции должен выполняться на следующих условиях: 
Если открыта длинная позиция, и FMA становится ниже SMA на «Пересечение» пунктов  или открыта короткая позиция, и FMA становится выше SMA на «Пересечение» пунктов,  то робот должен закрыть текущую позицию и открыть новую в обратном направлении, объемом «Объем заявки». 
При закрытии позиции необходимо учитывать, что ее размер может отличаться от значения «Объем заявки» если позиция была открыта вручную до запуска робота. 
Закрытие позиции 
Позиция может быть закрыта, на следующих условиях:  
1.	Исполнена заявка СЛ или ТП. 
2.	Произошло пересечение MA хотя бы на 1 пункт и параметр «Направление» имеет значение «Long» или «Short». 
После закрытия позиции робот должен повторить все условия, описанные выше в разделе «Открытие позиции». 
Управление условными (стоп-) заявками 
Робот должен следить за тем, чтобы СЛ и ТП заявки соответствовали текущей позиции. 
Если позиция открыта, то СЛ и ТП должны быть выставлены на расстоянии «Стоп-лосс» и «Тейк-профит» пунктов от средней цены позиции и их объем должен соответствовать объему позиции. 
Если позиция закрыта, то СЛ и ТП должны быть сняты. 
Если позиция изменена (произошел разворот), то СЛ и ТП должны быть сняты и выставлены заново. 
Такая логика должна быть задействована не только в процессе работы, но и при запуске робота.  
Если при запуске робота условные заявки не соответствуют позиции, то они должны быть изменены, сняты или выставлены. При этом необходимо учитывать, что размер позиции может отличаться от значения «Объем заявки» если позиция была открыта вручную до запуска робота. 
Если позиция была открыта давно и при запуске роботу не удается рассчитать среднюю цену позиции и условные заявки неактивны, то до пересечения MA робот должен продолжить работу без них. Если условные заявки активны, то робот не должен их изменять. 
 	 
Направления торговли 
Параметр «Направление» включает 3 возможных значения: «Revers», «Long» и «Short». 
В направлении «Revers» робот должен открывать как короткую, так и длинную позицию.  
В направлении «Long» робот должен открывать только длинную позицию. 
В направлении «Short» робот должен открывать только короткую позицию. 
Если при запуске робота направление позиции не соответствует выбранному режиму, то она должна быть автоматически закрыта. Например, если при запуске открытка короткая позиция и задан режим Long. 
Режимы торговли 
Параметр «Режим торговли» включает 2 возможных значения: «Непрерывно» и «Закрытие позиции» 
В режиме «Непрерывно» робот должен работать непрерывно с момента запуска до момента остановки вручную.  
В режиме «Закрытие позиции» робот должен однократно закрыть позицию и остановиться. Данный режим может применяться для закрытия позиции, открытой вручную до запуска робота, либо для однократного открытия позиции и закрытия позиции. Если робот запущен с данным режимом и по инструменту нет открытой позиции, то робот должен сначала открыть позицию по указанной выше логике, затем аналогично закрыть и остановиться. 
Дополнительные требования  
1.	Идентификаторы FMA и SMA должны формироваться автоматически на основе введенного кода инструмента. При этом должна быть предусмотрена возможность изменять их вручную для возможной параллельной работы с одним инструментом на разных графиках, с разными настройками или таймфреймами с разных счетов. 
2.	Доступные направления и режимы торговли должны изменяться при нажатии на соответствующую строку интерфейса. Каждому значению должен соответствовать цвет, указанный в ТЗ. 
Что вы получите в итоге при таком ТЗ 
В итоге вы получите робота, который будет представлять собой файл с расширением «.lua». Данный файл можно будет открыть с помощью обычного блокнота или специального редактора кода, например, Sublime Text. 
Для запуска робота данный файл необходимо поместить в любую удобную для вас папку, затем открыть терминал QUIK, нажать на кнопку меню «Сервисы» - «Lua скрипты …» - «Добавить», выбрать данный файл и нажать «Запустить». 
После этого откроется интерфейс робота, который будет содержать два столбца: в первый столбец будут записаны названия параметров, во второй - их значения. 
Далее вам необходимо ввести в интерфейсе необходимые входные данные, выбрать конкретные режимы и связать робота с индикаторами на графике с помощью сформированных и выведенных в интерфейс идентификаторов. 
После этого вам останется нажать на «Запустить» в интерфейсе робота, и вуаля! Теперь вы алготрейдер! 
Данное ТЗ служит примером хорошо сформулированной задачи. На практике, роботы могут включать как более простой, так и более сложный функционал. Ниже я привел перечень популярных функций, часто запрашиваемых для реализации. 
 	 
Возможный функционал  
Интерфейс  
1.	Обычный: все параметры и их значения записываются построчно. В такой реализации робот сможет работать только с одним инструментом. Для работы с множеством инструментов необходимо запускать робота повторно, отдельно для каждого инструмента (реализуется по умолчанию). 
2.	Мультиэмитентный: все параметры и их значения записываются по столбцам. В такой реализации каждая строка представляет собой набор параметров для работы с конкретным инструментом.  
Положение интерфейса 
1.	Открытие интерфейса при запуске робота на том-же месте где он был раньше. 
2.	Открытие дополнительного интерфейса в определенном месте относительно основного интерфейса. 
Входные данные 
1.	Воспроизведение последних сохраненных данных при запуске робота (реализуется по умолчанию). 
2.	Сохранение всех различных комбинаций входных данных с последующем выбором конкретной комбинации среди ранее сохраненных. Смена комбинаций может происходить по нажатию на клавиши, например, «влево» и/или «вправо», либо дополнительной кнопкой в интерфейсе, либо через дополнительный интерфейс. 
3.	Выбор конкретного номера счета, кода класса или инструмента вместо ввода с клавиатуры. Выбор также может происходить с помощью клавиш, кнопок, либо через дополнительный интерфейс. 
4.	Изменение входных данных в процессе работы робота. 
Формат значений входных данных 
1.	Пункты: вводим значение в пунктах, а робот сам переведет в шаг цены инструмента. Например, шаг цены 0.01, а в пунктах указываем 1 (реализуется по умолчанию). 
2.	Шаг цены: вводим значение с учетом шага цены. 
3.	Проценты: заявка выставляется при изменении цены на X% (указать относительно чего: последней сделки, открытия дня и т.п.). 
Можно реализовать возможность вводить все форматы значений в отдельные поля, либо в одно поле с распознаванием формата значения. Например, 10%, 10пт, 10. 
Режимы работы 
1.	Кнопки выбора направления торговли: «Revers», «Long», «Short»,  
2.	Кнопки выбора режима работы для фильтрации сделок. 
3.	… 
Демо режим 
Режим эмуляции реальных действий с записью всех событий в дополнительный интерфейс и/или отдельный файл. 
Оповещение при возникновении события (сделка, достижение уровня, ...) 
1.	Звуковое оповещение. 
2.	Уведомления в telegram. 
Учет позиции 
1.	Вывод в интерфейс объема открытой позиции. 
2.	Вывод в интерфейс средней цены позиции. 
Учет сделок 
1.	Вывод в интерфейс количества совершенных сделок за все время с момента запуска робота. 
2.	Вывод в интерфейс количества совершенных сделок за текущий торговый день. 
3.	Вывод в дополнительный интерфейс количества совершенных сделок за каждый торговый день с возможностью закрывать и вновь открывать данный интерфейс. 
4.	Запись всех сделок в файл. 
5.	… 
Расчет дохода 
Вывод в интерфейс: 
1.	Переменного дохода на открытую позицию (вариационная маржа только без пересчета во время клиринга). 
2.	Разницы текущей цены и средней цены позиции. 
3.	Фиксированного дохода от сделок, закрывших позицию (доход за все время с момента запуска робота). 
4.	Фиксированного дохода от сделок, закрывших позицию за текущий день. 
Вывод в дополнительный интерфейс: 
1.	Фиксированного дохода за каждый торговый день с возможностью закрывать и вновь открывать данный интерфейс. 
2.	… 
А также: 
1.	Учет комиссии при расчете дохода. 
2.	Запись дохода от каждой сделки, закрывшей позицию, в файл. 
3.	Восстановление истории сделок для расчета дохода: при запуске робота с открытыми позициями он должен восстановить историю сделок из таблицы или файла. 
4.	Восстановление истории дохода: при запуске робот считывает предыдущий доход из файла и будет прибавлять к нему новый. 
5.	… 
Риск менеджмент 
1.	Ограничение на общий убыток. 
2.	Ограничение на убыток за день. 
3.	Ограничение на общее количество отрицательных сделок. 
4.	Ограничение на количество отрицательных сделок за день. 
5.	Ограничение на количество подряд идущих отрицательных сделок. 
6.	Ограничение на перенос позиции на следующий день. 
7.	... 
Различный функционал 
1.	Расчет значения индикатора внутри робота. 
2.	Игнорирование заявок, выставленных вручную. 
3.	Обработка различных ошибок, таких как "Нехватка средств", "Попытка выставить заявку за планкой" и т.п. (по умолчанию робот просто остановится). 
4.	Настройка времени торгов (запрет торговли в определенное время). 
5.	Запрет торговли и закрытие позиций в день экспирации. 
6.	Вывод в интерфейс количества дней до экспирации. 
7.	Учет чужих заявок в стакане. 
8.	Учет остатка средств при открытии позиции. 
9.	Денежный формат времени: 10 000 000 вместо 10000000 
10.	Вывод необходимой информации в Excel. 
11.	Определение объема позиции исходя из капитала, волатильности и других показателей. 
12.	Трейлинг-стоп 
13.	Вывод в интерфейс статус/состояние робота. Например, "Ждем сигнал: Вход в long", "Сигнал: Вход в long", "Сигнал: Выход из long и вход в short", ... 
14.	Остановка робота с автоматическим закрытием позиции и снятием заявок. 
15.	... 
 
В зависимости от Ваших пожеланий, может быть реализован практически любой функционал в рамках терминала QUIK. 
Также, несмотря на приведенный выше список возможностей, в ТЗ Вы можете описать только свою стратегию. В таком случае я реализую минимально необходимый функционал для работы робота по Вашему алгоритму. 
 
